<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="icon" href="logo.jpg" type="image/jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body, html {
      width: 100%;
      margin: auto;
      padding: 0;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 90%;
    }
    a{
      text-decoration: none;
      padding: 5px;
      color: purple;
    }
    a:hover{
      color: purple;
    }
    .welcome{
      font-size: 16px;
      text-align: center;
      color: purple;
    }
    .container {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 1200px;
      width: 90%;
      margin: auto;
      box-shadow: 1px 1px 4px 2px rgb(226, 223, 223);
    }
    .login-container{
      width: 60%;
      margin: auto;
    }
    .login-container, .dashboard-container {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    h1, h2 {
      text-align: center;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .buttons {
      width: 90%;
      margin: auto;
      display: flex;
      justify-content: space-between;
    }
    button {
      padding: 10px;
      background-color: purple;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      width: 20%;
    }
    button:hover {
      background-color: rgb(255, 255, 255);
      color: purple;
      border-radius: 10px;
      border: 0.2px solid purple;
      font-weight: 600;
    }
    .error {
      color: red;
      text-align: center;
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    .display-area {
      display: none;
      width: 90%;
      height: 90%;
      margin: auto;
    }
    .close-button {
      margin-top: 20px;
      font-weight: 800;
      font-size: 16;
      background-color: white;
      color: red;
      box-shadow: 1px 1px 4px 2px rgb(226, 223, 223);
    }

    .actions{
     justify-items: center;
    }
    .actions button {
      width: 80px;
      height: 30px;
      padding: 5px;
      font-size: 12px;
    }

    #dropdown-menu {
     position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      height: 60%;
      background: purple;
      color: white;
      transition: left 0.3s ease;
      z-index: 1000;
    }
   nav{
margin-top: 4%;
height: 60%;}
    nav ul {
      width: 80%;
      height: 80%;
      list-style: none;
      padding: 20px;
      margin: 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin: auto;
      list-style-type: none;
    
    }
    nav ul li {
      width: 25%;
      height: 80%;
      margin: 20px auto;
      cursor: pointer;
      font-size: 16px;
      font-family: 'Times New Roman', Times, serif;
      text-decoration: none;
      font-weight: 800;
      color: purple;
      border: 1px solid purple;
      padding: 5%;
      border-radius: 30px;
      text-align: center;
      list-style-type: none;
    }
    nav ul li a {
      width: auto;
      border: 1px solid purple;
      color: purple;
      text-align: center;
      border-radius: 20px;
      font-size: 20px;
      padding:  20px 20%;
    }
    nav ul li a:hover {
      width: auto;
      background-color: purple;
      border: none;
      color: white;
      text-align: center;
      border-radius: 30px;

    }

    #taskArea{
      display: none;
      position: relative;
      flex-direction: row;
      height: 70%;
      width: 80%;
      margin-top: 15%;
      background-color: rgb(255, 255, 255);
      color: purple;
      margin: auto;
      position: fixed;
      padding: 10px;
      border-radius: 10px;
    }
    #exitTask{
      padding: 8px 16px;
      border: none;
      background-color: purple;
      color: white;
      border-radius: 5px;
    }
    .taskcontainer {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .taskcontainer h1, h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .taskcontainer form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }
    .taskcontainer input, select, textarea, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .taskcontainer button {
      background-color: purple;
      color: white;
      cursor: pointer;
    }
    .taskcontainer button:hover {
      background-color: #218838;
    }
    .taskcontainer ul {
      list-style-type: none;
      padding: 0;
    }
    .taskcontainer ul li {
      padding: 10px;
      margin-bottom: 10px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .taskcontainer .task-actions {
      display: flex;
      gap: 10px;
    }
    #tasksView{
      display: none;
      position: relative;
      flex-direction: row;
      height: 70%;
      width: 80%;
      margin-top: 15%;
      background-color: rgb(255, 255, 255);
      color: purple;
      margin: auto;
      position: fixed;
      padding: 10px;
      border-radius: 10px;
    }
    #tasksExitButton{
      padding: 8px 16px;
      border: none;
      background-color: purple;
      color: white;
      border-radius: 5px;
    }
    .tasksContainer{
      width: 60%;
      height: 80%;

    }
    .tasksContainer h1{
      font-size: 16px;
      color: purple;
      border-bottom: 3px solid purple;
    }
    .task-list {
      margin-top: 20px;
    margin: auto;
    padding: 5px;
  }
      


#tasksArea{
display: none;
      position: relative;
      flex-direction: row;
      height: 70%;
      width: 80%;
      margin-top: 15%;
      background-color: rgb(255, 255, 255);
      color: purple;
      margin: auto;
      position: fixed;
      padding: 10px;
      border-radius: 10px;}
#tasksExitButton{
      padding: 8px 16px;
      border: none;
      background-color: purple;
      color: white;
      border-radius: 5px;
    }
.tasksView{
width: 80%;
height: 90%;
color: purple;
}
.tasksView h1{
font-size: 16px;
color: purple;
}
.tasksView ul{
color: purple;}


    @media screen and (max-width: 678px){
      
      body{
        width: 100%;
        height: 98%;
        margin: auto;

      }
      .container{
        width: 90%;
        margin: auto;
      }
      .login-container, .dashboard-container {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      margin: auto;
    }
    .display-area {
      display: none;
      width: 90%;
      height: 90%;
      margin: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 5px;
      text-align: left;
      font-size: 14px;
    }
    .close-button {
      margin-top: 10px;
      font-weight: 500;
      font-size: 14px;
      background-color: white;
      color: red;
      box-shadow: 1px 1px 4px 2px rgb(226, 223, 223);
    }
    .actions{
     padding: 5px;
    }
    .actions button {
      width: 60px;
      height: 20px;
      margin: auto;
      font-size: 12px;
      margin-top: 2%;
    }
    .buttons {
      width: 90%;
      height: 10%;
      margin: auto;
      display: flex;
      justify-content: space-between;
    }
    .buttons button {
      padding: 10px;
      background-color: purple;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      width: 23%;
      height: 45%;
      font-size: 12px;
    }
    .buttons button .menuicon{
      width: 15%;
    }
    button:hover {
      background-color: rgba(255, 255, 255, 0.692);
      color: purple;
      font-weight: 600;
      border: 0.2px solid purple;
    }
nav{
height: 60%;
margin-top: 4%;}

    nav ul {
      width: 100%;
      height: 80%;
      list-style: none;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin: auto;
    
    }
    nav ul li {
      width: 30%;
      height: 8%;
      margin: 10px auto;
      cursor: pointer;
      font-size: 12px;
      font-family: 'Times New Roman', Times, serif;
      text-decoration: none;
      font-weight: 500;
      color: purple;
      border: 1px solid purple;
      border-radius: 30px;
      text-align: center;
    }
  
    nav ul li a {
      width: auto;
      border: 1px solid purple;
      color: purple;
      text-align: center;
      border-radius: 30px;
      font-size: 14px;
      padding: 5px 15%;

    }
    nav ul li a:hover {
      width: auto;
      background-color: purple;
      border: none;
      color: white;
      text-align: center;
      border-radius: 30px;

    }

#tasksArea{
display: none;
      flex-direction: column;
      height: 100%;
      width: 100%;
      background-color: rgb(255, 255, 255);
      color: purple;
      margin: auto;
      position: fixed;
      padding: 10px;
      border-radius: 10px;}

#tasksExitButton{
      padding: 8px 16px;
      border: none;
      background-color: purple;
      color: white;
      border-radius: 5px;
    }
    #tasksArea .taskButton, button{
      padding: 8px 16px;
      border: none;
      background-color: purple;
      color: white;
      border-radius: 5px;
    }

.tasksView{
width: 100%;
height: 90%;
color: purple;
}

    }
  </style>
</head>
<body>
  <div class="container login-container" id="loginContainer">
    <h1>Welcome Admin</h1>
    <p>Login to access your dashboard</p>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()">Login</button>
    <div class="error" id="error"></div>
  </div>

  <div class="container dashboard-container" id="dashboardContainer">

    <div class="welcome"><b id="adminName"></b><p id="adminDetails"></p></div>

    <div class="buttons">
      <button onclick="showSection('userDisplayArea')">Users</button>
      <button onclick="showSection('vendorDisplayArea')">Vendors</button>
      <button onclick="showSection('couponContainer')">Coupons</button>
      <button onclick="showSection('withdrawalRequestsArea')" class="menuIcon"><i class="fa fa-bars menu-icon"></i></button>
    </div>


    <div class="display-area" id="userDisplayArea">
      <!--<h2>Number of Users: <span id="userCount">0</span></h2>-->
      <table id="userTable">
        <thead>
          <tr>
            <th>Full Name</th>
         <!--   <th>Email</th>
            <th>Username</th>-->
            <th>Phone</th>
            <th>Wallet</th>
            <th>Elite Coin</th>
          </tr>
        </thead>
        <tbody>
          <!-- User data will be populated here -->
        </tbody>
      </table>
      <button class="close-button" onclick="hideSection('userDisplayArea')">Close</button>
     <a href="user.html">View More</a>
    </div>


    <div class="display-area" id="vendorDisplayArea">
      <!--<h2>Number of Vendors: <span id="vendorCount">0</span></h2>-->
      <table id="vendorTable">
        <thead>
          <tr>
            <th>Full Name</th>
            <!--<th>Email</th>
            <th>Username</th>-->
            <th>Phone</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Vendor data will be populated here -->
        </tbody>
      </table>
      <button class="close-button" onclick="hideSection('vendorDisplayArea')">Close</button>
    </div>

    <div class="display-area coupon-container" id="couponContainer">
      <h2>Active Coupons</h2>
      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Value</th>
            <th>Currency</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="couponTableBody">
        </tbody>
      </table>
      <button class="close-button" onclick="hideSection('couponContainer')">Close</button>
      <a href="coupon.html">Generate Coupon</a>
    </div>

    <div class="display-area" id="withdrawalRequestsArea">

      <!--<button class="close-button" onclick="hideSection('withdrawalRequestsArea')">Close</button>-->


      <div id="dropdown-menu">

        <div class="dropdown-header">
          </div>
          <i class="fa fa-times close-icon" onclick="toggleDropdownMenu()"></i>
        </div>
        <nav>
          <ul>
            <li><a href="#" id="socialTask">Task Lab</a></li>
            <li><a href="#" id="viewTasks">Tasks</a></li>
            <li><a href="#" id="airtime">Set VTU</a></li>
            <li><a href="#" id="openWithdrawal" >Withdraws</a></li>
            <li onclick="logoutUser()"><a href="#">Logout</a></li>
          </ul>
        </nav>
      </div>
    
    </div>
  </div>

<div id="taskArea">

    <button id="taskExitButton">Exit</button>

  <div class="taskcontainer">

    <form id="task-form">
      <input type="text" id="taskId" placeholder="Task ID" required>
      <input type="text" id="taskName" placeholder="Task Name" required>
      <textarea id="description" placeholder="Description" required></textarea>
      <input type="url" id="link" placeholder="Link" required>
      <select id="type" required>
        <option value="">Select Type</option>
        <option value="social">Social</option>
        <option value="advertisement">Advertisement</option>
      </select>
      <label for="selectAll"><input type="checkbox" id="selectAll"> Select All Users</label>

      <div id="user-select">
        <!-- User list will be populated here -->
      </div>
      <button type="submit" class="taskButton">Create</button>
    </form>

  </div>
   
</div>

</div>




<div id="tasksArea">

 <button id="tasksExitButton">Exit</button>

 <div class="tasksView>

      <h1>Tasks</h1>

      <ul id="task-list"></ul>

    </div>

</div>

<div id="tasksView">

  <button id="tasksExitButton">Exit</button>

  <div class="tasksContainer">
    <h2>Tasks</h2>
    <ul id="task-list"></ul>
  </div>
</div>

  <script>
    const API_URL = 'https://elitearn.onrender.com';

    document.addEventListener('DOMContentLoaded', () => {
      const isAuthenticated = localStorage.getItem('isAuthenticated');
      const loginContainer = document.getElementById('loginContainer');
      const dashboardContainer = document.getElementById('dashboardContainer');

      if (isAuthenticated) {
        loginContainer.style.display = 'none';
        dashboardContainer.style.display = 'block';
        document.getElementById('userDisplayArea').style.display = 'block';
        fetchAdminData();
      } else {
        loginContainer.style.display = 'flex';
        dashboardContainer.style.display = 'none';
      }
    });

    const fetchAdminData = async () => {
      const token = localStorage.getItem('token');

      if (!token) {
        localStorage.removeItem('isAuthenticated');
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('dashboardContainer').style.display = 'none';
        return;
      }

      try {
        const response = await fetch(`${API_URL}/admin-details`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
          },
        });

        if (response.ok) {
          const data = await response.json();
          document.getElementById('adminName').textContent = data.admin.fullName;
          document.getElementById('adminDetails').textContent = `Email: ${data.admin.email}`;
          fetchCounts();
          fetchCoupons();
          fetchNewUsers();
          fetchVendors();
        } else {
          alert('Failed to fetch admin data');
          localStorage.removeItem('token');
          localStorage.removeItem('isAuthenticated');
          document.getElementById('loginContainer').style.display = 'flex';
          document.getElementById('dashboardContainer').style.display = 'none';
        }
      } catch (error) {
        alert('Login to access admin account');
        localStorage.removeItem('token');
        localStorage.removeItem('isAuthenticated');
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('dashboardContainer').style.display = 'none';
      }
    };

    const login = async () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      try {
        const response = await fetch(`${API_URL}/login/admin`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ usernameOrEmail: username, password }),
        });

        const data = await response.json();
        if (response.ok) {
          localStorage.setItem('token', data.token);
          localStorage.setItem('isAuthenticated', 'true');
          document.getElementById('loginContainer').style.display = 'none';
          document.getElementById('dashboardContainer').style.display = 'block';
          document.getElementById('adminName').innerText = `Welcome, ${data.admin.fullName}`;
          fetchAdminData();
        } else {
          document.getElementById('error').innerText = data.message;
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('error').innerText = 'Login failed. Please try again.';
      }
    };

    const fetchCounts = async () => {
      try {
        const userResponse = await fetch(`${API_URL}/admin/user-count`);
        const userCount = await userResponse.json();
        document.getElementById('userCount').innerText = userCount;

        const vendorResponse = await fetch(`${API_URL}/admin/vendor-count`);
        const vendorCount = await vendorResponse.json();
        document.getElementById('vendorCount').innerText = vendorCount;
      } catch (error) {
        console.error('Error fetching counts:', error);
      }
    };

    const fetchCoupons = async () => {
      try {
        const response = await fetch(`${API_URL}/coupons`);
        const coupons = await response.json();

        const couponTableBody = document.getElementById('couponTableBody');
        couponTableBody.innerHTML = '';

        coupons.forEach((coupon) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${coupon.code}</td>
            <td>${coupon.value}</td>
            <td>${coupon.currency}</td>
         <td>${coupon.isActive ? 'Active' : 'Used'}</td>
          `;
          couponTableBody.appendChild(row);
        });
      } catch (error) {
        console.error('Error fetching coupons:', error);
      }
    };

    const fetchNewUsers = async () => {
      const token = localStorage.getItem('token');

      if (!token) {
        localStorage.removeItem('isAuthenticated');
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('dashboardContainer').style.display = 'none';
        return;
      }

      try {
        const response = await fetch(`${API_URL}/admin/user`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
          },
        });

        if (response.ok) {
          const users = await response.json();
          const userTableBody = document.querySelector('#userTable tbody');
          userTableBody.innerHTML = '';

          users.forEach((user) => { /*<td>${user.email}</td>
            <td>${user.username}</td> */
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${user.fullName}</td>
              <td>${user.phone}</td>
              <td>${user.wallet}</td>
              <td>${user.referralWallet}</td>
            `;
            userTableBody.appendChild(row);
          });
        } else {
          alert('Failed to fetch user data');
        }
      } catch (error) {
        alert('An error occurred while fetching user data');
      }
    };
    
    
    const fetchVendors = async () => {
    try {
        const response = await fetch(`${API_URL}/admin/vendors`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
            },
        });
        const vendors = await response.json();
        const vendorTableBody = document.querySelector('#vendorTable tbody');
        vendorTableBody.innerHTML = '';

        vendors.forEach((vendor) => { /*<td>${vendor.email}</td>
          <td>${vendor.username}</td>*/
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${vendor.fullName}</td>
              <td>${vendor.phone}</td>
              <td>${vendor.active}</td>
              <td class="actions">
                <button onclick="setVendorStatus('${vendor._id}', true)">Approve</button>
                <button onclick="setVendorStatus('${vendor._id}', false)">Suspend</button>
              </td>
            `;
            vendorTableBody.appendChild(row);
        });
    } catch (error) {
        console.error('Error fetching vendors:', error);
    }
};


const setVendorStatus = async (vendorId, status) => {
    try {
        const response = await fetch(`${API_URL}/admin/vendors/${vendorId}/status`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
            },
            body: JSON.stringify({ status }),
        });

        if (response.ok) {
            fetchVendors();
        } else {
            alert('Failed to update vendor status');
        }
    } catch (error) {
        console.error('Error updating vendor status:', error);
    }
};


    const handleUpdate = (userId) => {
      // Update user logic here
      console.log('Update user:', userId);
    };

    const handleDelete = (userId) => {
      if (confirm('Are you sure you want to delete this user?')) {
        // Delete user logic here
        console.log('Delete user:', userId);
      }
    };

    const showSection = (sectionId) => {
      const sections = document.querySelectorAll('.display-area');
      sections.forEach((section) => section.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
    };

    const hideSection = (sectionId) => {
      document.getElementById(sectionId).style.display = 'none';
    };






    document.addEventListener('DOMContentLoaded', function() {
      const openTaskButton = document.getElementById('socialTask');
      const taskPage = document.getElementById('taskArea');
      const dashboard = document.getElementById('dashboardContainer');
      const taskExitButton = document.getElementById('taskExitButton');

      openTaskButton.addEventListener('click', function(event) {
        event.preventDefault();
        taskPage.style.display = 'block';
        dashboard.style.display = 'none';
      });

      taskExitButton.addEventListener('click', function(event) {
        event.preventDefault();
        taskPage.style.display = 'none';

        dropdown.style.display = 'block';

        dashboard.style.display = 'block';


      });
    });



    document.addEventListener('DOMContentLoaded', function() {
      const openTasksView = document.getElementById('viewTasks');
      const tasksPage = document.getElementById('tasksView');
      const dropdown = document.getElementById('dropdown-menu');
      const tasksExitButton = document.getElementById('tasksExitButton');

      openTasksView.addEventListener('click', function(event) {
        event.preventDefault();
        tasksPage.style.display = 'block';
        dropdown.style.display = 'none';
      });

      tasksExitButton.addEventListener('click', function(event) {
        event.preventDefault();
        tasksPage.style.display = 'none';
        dropdown.style.display = 'block';

      });
    });


    document.addEventListener('DOMContentLoaded', () => {
    const taskForm = document.getElementById('task-form');
    const taskList = document.getElementById('task-list');
    const userSelect = document.getElementById('user-select');
    const selectAllCheckbox = document.getElementById('selectAll');

    // Function to fetch users
    const fetchUsers = async () => {
        try {
            const response = await fetch(`${API_URL}/admin/users`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });
            const users = await response.json();

            userSelect.innerHTML = ''; // Clear existing users
            users.forEach(user => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="checkbox" name="users" value="${user._id}"> ${user.username}
                `;
                userSelect.appendChild(label);
            });
        } catch (error) {
            console.error('Error fetching users:', error);
        }
    };

    // Handle "Select All" checkbox
    selectAllCheckbox.addEventListener('change', (e) => {
        const checkboxes = userSelect.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = e.target.checked;
        });
    });

    // Handle task form submission
    taskForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const taskData = {
            taskId: document.getElementById('taskId').value,
            taskName: document.getElementById('taskName').value,
            description: document.getElementById('description').value,
            link: document.getElementById('link').value,
            type: document.getElementById('type').value,
            userIds: Array.from(userSelect.querySelectorAll('input[name="users"]:checked')).map(cb => cb.value)
        };

        try {
            const response = await fetch(`${API_URL}/admin/create-task`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(taskData)
            });
            const result = await response.json();
            alert(result.message);
            fetchTasks(); // Refresh the task list
        } catch (error) {
            console.error('Error creating task:', error);
        }
    });

    // Fetch and display tasks
    const fetchTasks = async () => {
        try {
            const response = await fetch(`${API_URL}/admin/tasks`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });
            const tasks = await response.json();
            taskList.innerHTML = '';
            tasks.forEach(task => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${task.taskName} - ${task.description}
                    <div class="task-actions">
                        <button onclick="deleteTask('${task._id}')">Delete Task</button>
                    </div>
                `;
                taskList.appendChild(li);
            });
        } catch (error) {
            console.error('Error fetching tasks:', error);
        }
    };

    // Delete a task
    window.deleteTask = async (taskId) => {
        try {
            const response = await fetch(`${API_URL}/admin/delete-task/${taskId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });
            const result = await response.json();
            alert(result.message);
            fetchTasks(); // Refresh the task list
        } catch (error) {
            console.error('Error deleting task:', error);
        }
    };

    fetchUsers(); // Fetch users when the page loads
    fetchTasks(); // Fetch tasks when the page loads
});

  


/*
document.addEventListener('DOMContentLoaded', () => {
      const taskForm = document.getElementById('task-form');
      const taskList = document.getElementById('task-list');
      const userSelect = document.getElementById('user-select');
      const selectAllCheckbox = document.getElementById('selectAll');

      async function fetchUsers() {
        try {
          const response = await fetch(`${API_URL}/admin/users`);
          const users = await response.json();
          userSelect.innerHTML = '';
          users.forEach(user => {
            const label = document.createElement('label');
            label.innerHTML = `
              <input type="checkbox" name="users" value="${user._id}"> ${user.username}
            `;
            userSelect.appendChild(label);
          });
        } catch (error) {
          console.error('Error fetching users:', error);
        }
      }

      selectAllCheckbox.addEventListener('change', (e) => {
        const checkboxes = userSelect.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = e.target.checked;
        });
      });

      taskForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const taskData = {
          taskId: document.getElementById('taskId').value,
          taskName: document.getElementById('taskName').value,
          description: document.getElementById('description').value,
          link: document.getElementById('link').value,
          type: document.getElementById('type').value,
          userIds: Array.from(userSelect.querySelectorAll('input[name="users"]:checked')).map(cb => cb.value)
        };

        try {
          const response = await fetch(`${API_URL}/admin/create-task`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(taskData)
          });
          const result = await response.json();
          alert(result.message);
          fetchTasks();
        } catch (error) {
          console.error('Error creating task:', error);
        }
      });

      async function fetchTasks() {
        try {
          const response = await fetch(`${API_URL}/admin/tasks`);
          const tasks = await response.json();
          taskList.innerHTML = '';
          tasks.forEach(task => {
            const li = document.createElement('li');
            li.innerHTML = `
              ${task.taskName} - ${task.description}
              <div class="task-actions">
                <button onclick="deleteTask('${task._id}')">Delete Task</button>
              </div>
            `;
            taskList.appendChild(li);
          });
        } catch (error) {
          console.error('Error fetching tasks:', error);
        }
      }

      window.deleteTask = async (taskId) => {
        try {
          const response = await fetch(`${API_URL}/admin/delete-task/${taskId}`, {
            method: 'DELETE'
          });
          const result = await response.json();
          alert(result.message);
          fetchTasks();
        } catch (error) {
          console.error('Error deleting task:', error);
        }
      };


      fetchTasks();
    });
*/

document.addEventListener('DOMContentLoaded', () => {
      const taskForm = document.getElementById('task-form');
      const taskList = document.getElementById('task-list');
      const userSelect = document.getElementById('user-select');
      const selectAllCheckbox = document.getElementById('selectAll');

      async function fetchUsers() {
        try {
          const response = await fetch(`${API_URL}/admin/users`);
          const users = await response.json();
          userSelect.innerHTML = '';
          users.forEach(user => {
            const label = document.createElement('label');
            label.innerHTML = `
              <input type="checkbox" name="users" value="${user._id}"> ${user.username}
            `;
            userSelect.appendChild(label);
          });
        } catch (error) {
          console.error('Error fetching users:', error);
        }
      }

      selectAllCheckbox.addEventListener('change', (e) => {
        const checkboxes = userSelect.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = e.target.checked;
        });
      });

      taskForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const taskData = {
          taskId: document.getElementById('taskId').value,
          taskName: document.getElementById('taskName').value,
          description: document.getElementById('description').value,
          link: document.getElementById('link').value,
          type: document.getElementById('type').value,
          userIds: Array.from(userSelect.querySelectorAll('input[name="users"]:checked')).map(cb => cb.value)
        };

        try {
          const response = await fetch(`${API_URL}/admin/create-task`,
 {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(taskData)
          });
          const result = await response.json();
          alert(result.message);
          fetchTasks();
        } catch (error) {
          console.error('Error creating task:', error);
        }
      });

      async function fetchTasks() {
        try {
          const response = await fetch(`${API_URL}/admin/tasks`); 
          const tasks = await response.json();
          taskList.innerHTML = '';
          tasks.forEach(task => {
            const li = document.createElement('li');
            li.innerHTML = `
              ${task.taskName} - ${task.description}
              <div class="task-actions">
                <button onclick="deleteTask('${task._id}')">Delete Task</button>
              </div>
            `;
            taskList.appendChild(li);
          });
        } catch (error) {
          console.error('Error fetching tasks:', error);
        }
      }

      window.deleteTask = async (taskId) => {
        try {
          const response = await fetch(`${API_URL}/admin/delete-task/${taskId}`, {
            method: 'DELETE'
          });
          const result = await response.json();
          alert(result.message);
          fetchTasks();
        } catch (error) {
          console.error('Error deleting task:', error);
        }
      };


      fetchUsers();
      fetchTasks();
    });

    

    async function logoutUser() {
      localStorage.removeItem("token");
      document.getElementById("dashboardContainer").style.display = "none";
      document.getElementById("loginContainer").style.display = "block";
      
    }




document.addEventListener('DOMContentLoaded', function() {
      const openTasks= document.getElementById('viewTasks');
      const tasksArea = document.getElementById('tasksArea');
      const dashboard = document.getElementById('dashboardContainer');
      const tasksExitButton = document.getElementById('tasksExitButton');

      openTasks.addEventListener('click', function(event) {
        event.preventDefault();
        tasksArea.style.display = 'block';
        dashboard.style.display = 'none';
      });

      tasksExitButton.addEventListener('click', function(event) {
        event.preventDefault();
        tasksArea.style.display = 'none';
        dashboard.style.display = 'block';

      });
    });
  </script>
</body>
</html>

